# 要件定義書 (REQUIREMENT.md)

## 1. プロジェクト概要

### 1.1 プロジェクト名

AWS Infrastructure as Code Project

### 1.2 目的

AWS 向けの Infrastructure as Code（IaC）を開発し、Web アプリケーション用のインフラストラクチャを構築することを目的とします。

### 1.3 背景

クラウドインフラストラクチャのコード化により、インフラの再現性、保守性、バージョン管理を実現します。本プロジェクトでは、AWS 上に Web アプリケーション用のインフラストラクチャを構築します。

### 1.4 アプリケーション概要

本プロジェクトで構築するアプリケーションは、Todo アプリケーションです。

- **フロントエンド**: Next.js（Client-Side Rendering: CSR）
- **バックエンド**: FastAPI
- **認証認可**: AWS Cognito
- **AI サービス**: AWS Bedrock（Todo の内容記載補助に使用）
- **データベース**: DynamoDB（ユーザーが入力したタスクデータを保管）
- **静的コンテンツ**: S3 バケットに配置

## 2. アーキテクチャ

### 2.1 全体アーキテクチャ

```text
┌─────────────────────────────────────────────────────────────┐
│                    AWS インフラストラクチャ                  │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐    │
│  │   VPC    │ │   ECS    │ │DynamoDB │ │   S3     │    │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘    │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐    │
│  │   IAM    │ │Security  │ │ Bedrock  │ │ Cognito  │    │
│  │          │ │ Groups   │ │          │ │          │    │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘    │
└─────────────────────────────────────────────────────────────┘
```

## 3. 技術スタック

### 3.1 クラウドプロバイダ

- **AWS (Amazon Web Services)**
  - リージョン: ap-northeast-1（東京）
  - 認証は AWS CLI または環境変数による認証情報設定をサポートする

### 3.2 Infrastructure as Code

- **Terraform**
  - 最新の安定バージョンを使用する
  - AWS Provider の最新の安定バージョンを使用する
  - 状態管理は環境に応じて適切に設定する

## 4. システム構成

### 4.1 ネットワークカテゴリ

#### 4.1.1 VPC (Virtual Private Cloud)

- 適切な IP アドレス空間を確保する
- 複数の可用性ゾーンで構成し、高い可用性を考慮する
- DNS ホスト名と DNS 解決を有効化する
- 適切なタグ付けを実施する

#### 4.1.2 サブネット構成

- パブリックサブネットとプライベートサブネットを分離する
- 複数の可用性ゾーンに分散配置し、可用性を確保する
- パブリックサブネットには自動割り当てパブリック IP を有効化する
- 適切な IP アドレス範囲を割り当てる

#### 4.1.3 インターネット接続

- パブリックサブネットからインターネットへの接続を提供する
- インターネットゲートウェイを適切に設定する
- パブリックサブネット用のルートテーブルを設定する

#### 4.1.4 NAT ゲートウェイ

- プライベートサブネットからインターネットへのアウトバウンド接続を提供する
- パブリックサブネットに配置する
- プライベートサブネット用のルートテーブルを設定する

### 4.2 コンピューティングカテゴリ

#### 4.2.1 ECS (Elastic Container Service)

- Web アプリケーション用のコンテナオーケストレーションサービスを提供する
- フロントエンド（Next.js CSR）とバックエンド（FastAPI）のコンテナを実行する
- プライベートサブネットに配置し、セキュリティを確保する
- 開発環境に適したコンピューティングリソースを使用する
- 適切な IAM ロールを設定する
- セキュリティグループを設定する
- タスク定義とサービスを適切に設定する
- 適切なタグ付けを実施する

### 4.3 データベースカテゴリ

#### 4.3.1 DynamoDB

- ユーザーが入力したタスクデータを保管する NoSQL データベースを提供する
- サーバーレスで運用負荷を削減する
- 開発環境に適した容量モードを選択する（オンデマンドまたはプロビジョンド）
- バックアップを有効化する
- 暗号化を設定する
- 適切な IAM ロール・ポリシーでアクセス制御を行う
- 適切なタグ付けを実施する

### 4.4 ストレージカテゴリ

#### 4.4.1 S3 バケット

- 静的コンテンツ用のオブジェクトストレージを提供する
- Next.js の静的アセット（画像、CSS、JavaScript など）を配置する
- グローバルで一意なバケット名を使用する
- バージョニングを有効化する
- 暗号化を設定する
- パブリックアクセスは必要に応じて設定する（静的コンテンツ配信のため）
- コスト最適化のためのライフサイクルポリシーを検討する
- 適切なタグ付けを実施する

### 4.5 認証カテゴリ

#### 4.5.1 AWS Cognito

- ユーザー認証・認可を提供する
- ユーザープールを作成する
- 適切な認証フローを設定する
- ECS アプリケーションと Cognito を連携する
- 適切なタグ付けを実施する

### 4.6 AI サービスカテゴリ

#### 4.6.1 AWS Bedrock

- Todo の内容記載補助に使用する AI サービスを利用する
- Bedrock へのアクセス権限を適切に設定する
- 適切なタグ付けを実施する

### 4.7 セキュリティカテゴリ

#### 4.7.1 IAM ロール・ポリシー

- 各リソースに適切な IAM ロールを作成する
- 最小権限の原則に従ったポリシーを設定する
- ECS タスクから S3 へのアクセス権限を設定する
- ECS タスクから DynamoDB へのアクセス権限を設定する
- ECS タスクから Bedrock へのアクセス権限を設定する
- CloudWatch Logs への書き込み権限を設定する
- 適切なタグ付けを実施する

#### 4.7.2 セキュリティグループ

- 各リソースタイプに適切なセキュリティグループを作成する
- 最小権限の原則に従ったネットワークアクセス制御を設定する
- ECS 用セキュリティグループでは、必要なポートのみを開放する
- 適切なタグ付けを実施する

## 5. 機能要件

### 5.1 ネットワーク機能要件

#### FR-001: VPC 構築

- 適切な IP アドレス空間で VPC を作成する
- DNS 機能を有効化する
- 適切なタグ付けを実施する

#### FR-002: サブネット構築

- パブリックサブネットとプライベートサブネットを分離する
- 複数の可用性ゾーンに分散配置する
- 適切な IP アドレス範囲を割り当てる
- パブリックサブネットには自動割り当てパブリック IP を有効化する

#### FR-003: インターネット接続

- パブリックサブネットからインターネットへの接続を提供する
- インターネットゲートウェイを適切に設定する
- パブリックサブネット用のルートテーブルを設定する

#### FR-004: NAT ゲートウェイ構築

- プライベートサブネットからインターネットへのアウトバウンド接続を提供する
- NAT ゲートウェイを適切に配置する
- プライベートサブネット用のルートテーブルを設定する

### 5.2 コンピューティング機能要件

#### FR-005: ECS 構築

- Web アプリケーション用の ECS クラスター、サービス、タスク定義を作成する
- フロントエンド（Next.js CSR）とバックエンド（FastAPI）のコンテナを実行する
- プライベートサブネットに配置する
- 適切な IAM ロールを設定する
- セキュリティグループを設定する
- コンテナイメージを適切に設定する

### 5.3 データベース機能要件

#### FR-006: DynamoDB テーブル構築

- ユーザーが入力したタスクデータを保管する DynamoDB テーブルを作成する
- 適切なパーティションキーとソートキーを設計する
- バックアップを有効化する
- 暗号化を設定する
- 適切な IAM ロール・ポリシーでアクセス制御を行う

### 5.4 ストレージ機能要件

#### FR-007: S3 バケット構築

- 静的コンテンツ用のオブジェクトストレージバケットを作成する
- Next.js の静的アセットを配置する
- グローバルで一意なバケット名を使用する
- バージョニングを有効化する
- 暗号化を設定する
- 静的コンテンツ配信に必要なパブリックアクセス設定を検討する

### 5.5 認証機能要件

#### FR-008: AWS Cognito 構築

- ユーザー認証・認可用の Cognito ユーザープールを作成する
- 適切な認証フローを設定する
- ECS アプリケーションと Cognito を連携する
- 適切な設定を実施する

### 5.6 AI サービス機能要件

#### FR-009: AWS Bedrock アクセス設定

- Todo の内容記載補助に使用する Bedrock へのアクセス権限を適切に設定する
- ECS タスクから Bedrock へのアクセス権限を設定する
- 最小権限の原則に従ったポリシーを設定する

### 5.7 セキュリティ機能要件

#### FR-010: IAM ロール・ポリシー構築

- 各リソースに適切な IAM ロールを作成する
- 最小権限の原則に従ったポリシーを設定する
- ECS タスクから S3 へのアクセス権限を設定する
- ECS タスクから DynamoDB へのアクセス権限を設定する
- ECS タスクから Bedrock へのアクセス権限を設定する
- CloudWatch Logs への書き込み権限を設定する

#### FR-011: セキュリティグループ構築

- 各リソースタイプに適切なセキュリティグループを作成する
- 最小権限の原則に従ったネットワークアクセス制御を設定する
- ECS 用セキュリティグループでは、必要なポートのみを開放する

### 5.8 統合機能要件

#### FR-012: リソース間連携

- ECS から DynamoDB へのアクセスが可能であること
- ECS から S3 へのアクセスが可能であること
- ECS から Bedrock へのアクセスが可能であること
- ECS アプリケーションと Cognito が連携できること
- 適切な IAM ロール・ポリシーとセキュリティグループルールが設定されていること

#### FR-013: 出力値の提供

- Terraform の出力値で重要な情報を提供する
- VPC ID、サブネット ID、ECS クラスター情報、DynamoDB テーブル名、S3 バケット名、Cognito ユーザープール ID などを出力する

## 6. 非機能要件

### 6.1 セキュリティ要件

#### NFR-001: セキュリティベストプラクティス準拠

- **要件**: AWS のセキュリティベストプラクティスに準拠する
- **詳細**:
  - プライベートサブネットにアプリケーションリソースを配置
  - 最小権限の原則に従った IAM ポリシー
  - 適切なセキュリティグループルール
  - 暗号化の適用（S3、DynamoDB）

#### NFR-002: ネットワークセキュリティ

- **要件**: 適切なネットワークセキュリティを実装する
- **詳細**:
  - パブリックアクセスの最小化
  - セキュリティグループによる細かいアクセス制御
  - 不要なポートの開放を避ける

#### NFR-003: データ保護

- **要件**: データの保護を実装する
- **詳細**:
  - S3 バケットの暗号化
  - DynamoDB の暗号化
  - バックアップの設定

### 6.2 可用性要件

#### NFR-004: マルチ AZ 構成

- **要件**: 可用性を考慮した構成とする
- **詳細**:
  - 複数の AZ にリソースを分散配置
  - 将来的なマルチ AZ 対応を考慮した設計

### 6.3 保守性要件

#### NFR-005: コード品質

- **要件**: 保守しやすいコードを生成する
- **詳細**:
  - 適切な変数の使用
  - モジュール化の推進
  - コメントの充実
  - 命名規則の統一

#### NFR-006: ドキュメント

- **要件**: 適切なドキュメントを提供する
- **詳細**:
  - README.md の作成
  - 変数の説明
  - 使用方法の記載

### 6.4 コスト要件

#### NFR-007: コスト最適化

- **要件**: 開発環境として適切なコストで運用する
- **詳細**:
  - 開発環境に適したリソースサイズを選択する
  - 不要なリソースを作成しない
  - 適切なストレージサイズを設定する

## 7. 制約事項

### 7.1 技術的制約

- 開発環境に適したコスト範囲で実装する
- Terraform の最新の安定バージョンを使用する
- AWS Provider の最新の安定バージョンを使用する

### 7.2 環境制約

- 開発環境として構築する（本番環境ではない）
- リージョン: ap-northeast-1（東京）で実装する

### 7.3 セキュリティ制約

- 本番環境の認証情報は使用しない
- テスト用の AWS アカウントを使用する

## 8. リスクと対策

### 8.1 技術的リスク

- **リスク**: Terraform コードのエラー
- **対策**: 適切なエラーハンドリングとバリデーションを実装

### 8.2 セキュリティリスク

- **リスク**: 不適切なセキュリティ設定
- **対策**: セキュリティベストプラクティスに準拠した実装

### 8.3 コストリスク

- **リスク**: 予期しない AWS コストの発生
- **対策**: 無料枠内での実装、リソースの適切な管理

## 9. 用語集

- **IaC**: Infrastructure as Code（コードとしてのインフラ）
- **VPC**: Virtual Private Cloud（仮想プライベートクラウド）
- **AZ**: Availability Zone（可用性ゾーン）
- **CIDR**: Classless Inter-Domain Routing（クラスレスドメイン間ルーティング）
- **ECS**: Elastic Container Service（AWS のコンテナオーケストレーションサービス）
- **Bedrock**: AWS Bedrock（AWS のマネージド AI サービス）
- **Cognito**: AWS Cognito（AWS のマネージド認証・認可サービス）
- **DynamoDB**: Amazon DynamoDB（AWS のマネージド NoSQL データベースサービス）
- **Next.js**: React ベースの Web アプリケーションフレームワーク
- **FastAPI**: Python ベースの高速な Web API フレームワーク
- **CSR**: Client-Side Rendering（クライアントサイドレンダリング）

## 10. 参考資料

- [AWS 公式ドキュメント](https://docs.aws.amazon.com/)
- [Terraform AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)

---

**作成日**: 2025 年 11 月 15 日
**最終更新日**: 2025 年 11 月 15 日
**バージョン**: 1.0
